{% extends "base.html" %}
{% block title %}Challenges{% endblock %}
{% block head %}
<script>
var state = {{ solved.count() }};
function openAll() {
    $(".collapsible-header").each(function(i, x){ $(x).hasClass("active") || $(x).click(); });
}
function closeAll() {
    $(".collapsible-header").each(function(i, x){ $(x).hasClass("active") && $(x).click(); });
}
function toggle() {
    if(state) closeAll();
    else openAll();
    state = !state;
}
</script>
<style type="text/css">
    .collapsible-header {
        background-color: #eee;
    }
</style>
{% endblock %}
{% block content %}
<p>You are scoring on behalf of {{ team.name }}. If this is incorrect, you should
<a href="{{ url_for('logout') }}">logout</a> and login with the correct team key.</p>
<a href="javascript:toggle()">Toggle collapsed state</a>
<ul class="collapsible" data-collapsible="expandable">
    {% for challenge in challenges %}
    <li>
        <div class="collapsible-header{% if challenge not in solved %} active{% endif %}">
            <strong style="font-size: 110%;">{{ challenge.name }}</strong>
            <span class="left" style="margin-right: -5px;">{% if challenge in solved %}<i class="material-icons">check</i>{% endif %}</span>
            <span class="right">{{ challenge.category }} <b>&middot;</b> {{ challenge.points }} pt</span>
        </div>
        <div class="collapsible-body">
            <p>{{ challenge.description }}</p>
            {% if challenge in solved %}
            <p>You've solved this challenge!</p>
            {% else %}
            <form action="{{ url_for('submit', challenge=challenge.id) }}" method="POST">
                <div class="container">
                    <div class="input-field">
                        <input required id="flag" name="flag" type="text" />
                        <label for="flag">Flag</label>
                    </div>
                    <button class="btn waves-effect waves-light" type="submit">Submit</button>
                </div>
                <input name="_csrf_token" type="hidden" value="{{ csrf_token() }}" />
            </form><br />
            {% endif %}
        </div>
    </li>
    {% endfor %}
</ul>
{% endblock %}
