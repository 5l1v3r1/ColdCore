{% extends "base.html" %}
{% block title %}Challenges{% endblock %}
{% block head %}
<script>
var state = {{ solved.count() }};
function openAll() {
    $(".collapsible-header").each(function(i, x){ $(x).hasClass("active") || $(x).click(); });
}
function closeAll() {
    $(".collapsible-header").each(function(i, x){ $(x).hasClass("active") && $(x).click(); });
}
function toggle() {
    if(state) closeAll();
    else openAll();
    state = !state;
}
</script>
{% endblock %}
{% block content %}
<p>You are scoring on behalf of {{ team.name }}. If this is incorrect, you should
<a href="{{ url_for('logout') }}">logout</a> and login with the correct team key.</p>
<a href="javascript:toggle()">Toggle collapsed state</a>
<ul class="collapsible popout" data-collapsible="expandable">
    {% for challenge in challenges %}
    <li>
        <div class="collapsible-header{% if challenge not in solved %} active{% endif %}">
            <strong>{% if challenge in solved %}<i class="material-icons">check</i>{% endif %}{{ challenge.name }}</strong>
            <span class="right">{% if challenge in solved %}Solved{% else %}Unsolved{% endif %}: {{ challenge.points }}pt. {{ challenge.category }}</span>
        </div>
        <div class="collapsible-body">
            <p>{{ challenge.description }}</p>
            {% if challenge in solved %}
            <p>You've solved this challenge!</p>
            {% else %}
            <form action="{{ url_for('submit', challenge=challenge.id) }}" method="POST">
                <div class="container">
                    <div class="input-field">
                        <input id="flag" name="flag" type="text" />
                        <label for="flag">Flag</label>
                    </div>
                    <button class="btn waves-effect waves-light" type="submit">Submit flag</button>
                </div>
                <input name="_csrf_token" type="hidden" value="{{ csrf_token() }}" />
            </form><br />
            {% endif %}
        </div>
    </li>
    {% endfor %}
</ul>
{% endblock %}
